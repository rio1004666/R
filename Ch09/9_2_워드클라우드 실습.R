# 날짜 : 2021/09/30

# 이름 : 강병화

# 내용 : 정형과 비정형 데이터 처리 - 텍스트 시각화 실습 처리 교재 P301


install.packages('Sejong')
install.packages('wordcloud')
install.packages('tm')
install.packages('hash')
install.packages('rJava')
install.packages('tau')
install.packages('RSQLite')
install.packages('cli')
install.packages('rcmdcheck')
install.packages('devtools')


library('KoNLP')
library('tm')
library('wordcloud')

word_cloud <- file('C:\\Users\\????ȭ\\Desktop\\WorkSpace\\R\\file\\wordcloud_data.txt', encoding = 'UTF-8')
word_data <- readLines(word_cloud)
word_data
head(word_data)

# term = '?߰??ܾ?', tag = ncn(?????????ڵ?)
user_dic <- data.frame(term = c("R ?��α׷???","???̽???","??????","?Ҽȳ?Ʈ??ũ"),tag = 'ncn')
buildDictionary(ext_dic = 'sejong', user_dic = user_dic)

paste(extractNoun('??????�� ??�� ?????? ????�� ��?ؼ? ?Ҽȳ?Ʈ??ũ?? ?????Ͽ??��ϴ?.'),
      collapse=" ") # ?űԴܾ ?????ǰ? extractNoun?Լ???, collapse?Ӽ?��?? ??????�� ????��?? ?????Ѵ? 
# ?ǽ? 306p - ?ܾ? ????�� ��?? ?????? ?Լ? ��???ϱ? 

# ?ܰ? 1: ?????? ��?? ?Լ? ?ۼ? 
exNouns <- function(x) { paste(extractNoun(as.character(x)), collapse = " ")}
# ?ܰ? 2: exNouns()?Լ??? ?̿??Ͽ? ?ܾ? ???? 
wordcloud_nouns <- sapply(word_data, exNouns) # ?ܾ? ???? 
wordcloud_nouns[1]  # ?ܾ ?????? ù ?? ???? 
################################################################

# ?ǽ? 307p - ?????? ?ܾ ????��?? ??ó???ϱ? 
# ?????? ?ܾ ????��?? ??ó???ϱ? 
myCorpus <- Corpus(VectorSource(wordcloud_nouns))
myCorpus
# ?????? ?ܾ ????��?? ó???? ?? ?ֵ??? ?????ϰų? ???ʿ??? ?ܾ ��???ϴ? 
# ??ó?? ??��???? tm??Ű?????? ��???Ǵ? tm_map()?Լ??? ?̿??Ѵ?. 

# ?ܰ? 2: ?????? ??ó?? 
# ?ܰ? 2-1: ??????ȣ 
myCorpusPrepro <- tm_map(myCorpus,removePunctuation)
# ?ܰ? 2-2:  ??ġ ��?? 
myCorpusPrepro <- tm_map(myCorpusPrepro,removeNumbers)
# ?ܰ? 2-3: ?ҹ??? ???? 
myCorpusPrepro <- tm_map(myCorpusPrepro,tolower)
# ?ܰ? 2-4:  ?ҿ??? ��?? 
myCorpusPrepro <- tm_map(myCorpusPrepro,removeWords, stopwords('english'))
# ?ܰ? 2-5: ??ó?? ???? Ȯ?? 
inspect(myCorpusPrepro[1:5])
###################################################################
# ?ǽ? 308p - ?ܾ? ????(2~8 ��?? ???? ?ܾ? ????) ?ϱ? 
# ?ѱ? 1��??�� 2byte?? ????(2��?? = 4byte)
myCorpusPrepro_term <-
  TermDocumentMatrix(myCorpusPrepro,
                     control = list(wordLength = c(4,16))) # 2~8��?? # Corpus ??ü ��?? 
myCorpusPrepro_term
# ?ܰ? 2: matrix ?ڷᱸ��?? data.frame ?ڷᱸ��?? ???? 
myTerm_df <- as.data.frame(as.matrix(myCorpusPrepro_term))
dim(myTerm_df)
###################################################################
# ?ܾ? ???? ?󵵼? ???ϱ? 
# ?ǽ? 309p - ?ܾ? ???? ?󵵼? ???ϱ? 
wordResult <- sort(rowSums(myTerm_df),decreasing = TRUE)
wordResult[1:10]
# ?ҿ??? ��?? 
# ?ܰ? 1: ?????? ??ó?? 
# ?ܰ? 1-1: ??????ȣ ��?? 
myCorpusPrepro <- tm_map(myCorpus,removePunctuation)
# ?ܰ? 1-2: ??ġ ��??
myCorpusPrepro <- tm_map(myCorpusPrepro,removeNumbers)
# ?ܰ? 1-3: ?ҹ??? ???? 
myCorpusPrepro <- tm_map(myCorpusPrepro,tolower)
myStopwords = c(stopwords('english'),"????","?ϱ?")
myCorpusPrepro <- tm_map(myCorpusPrepro,removeWords,myStopwords)

# ?ܰ?2: ?ܾ? ?????? ?򼭹? ??ȯ 
myCorpusPrepro_term <- TermDocumentMatrix(myCorpusPrepro,
                                          control = list(wordLengths = c(4,16))) # 2~8��?? 
# ????ġ ??ü?? ?򼭹?��?? ??ȯ 
myTerm_df <- as.data.frame(as.matrix(myCorpusPrepro_term))

# ?ܰ? 3: ?ܾ? ???? ?󵵼? ???ϱ? 

wordResult <- sort(rowSums(myTerm_df),decreasing = TRUE)
wordResult[1:10]
# ?ܰ?1: ?ܾ? ?̸??? ?󵵼??? data.frame ???? 
myName <- names(wordResult)
word_df <- data.frame(word = myName, freq = wordResult)
str(word_df)
# ?ܰ?2: ?ܾ? ?????? ?۲? ??�� 
pal <- brewer.pal(12,"Paired") # 12???? ???? ???? 
# ?ܾ? ????��?? ?ð?ȭ?ϱ? ��?ؼ??? wordcloud() ?Լ??? ?????Ѵ?.

# ?ܰ?3: ?ܾ? ???? ?ð?ȭ 
wordcloud(word_df$word,word_df$freq, scale = c(5,1),
          min.freq = 3, random.order = F,
          rot.per = .1, colors = pal, family = "malgun")
